import streamlit as st
import pandas as pd
import re # ì •ê·œ í‘œí˜„ì‹ ëª¨ë“ˆ (ê²€ìƒ‰ ìœ ì—°ì„± í™•ë³´)

# --- 1. ë°ì´í„° ì •ì˜ (ì‹¤í—˜ ë„êµ¬ ëª©ë¡) ---
# ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” CSV, ì—‘ì…€, ë°ì´í„°ë² ì´ìŠ¤ ë“± ì™¸ë¶€ íŒŒì¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
# (ë„êµ¬ëª…, ê¸°ëŠ¥/ìš©ë„, ì£¼ì˜ì‚¬í•­/ì¬ì§ˆ ë“±)
LAB_EQUIPMENT_DATA = {
    "ë„êµ¬ëª…": ["ë¹„ì»¤", "ì‚¼ê° í”Œë¼ìŠ¤í¬", "ì‹œí—˜ê´€", "ë©”ìŠ¤ ì‹¤ë¦°ë”", "í”¼í«", "í˜„ë¯¸ê²½", "ìŠ¤í¬ì´íŠ¸", "ì§‘ê²Œ", "ì˜¨ë„ê³„", "ì €ìš¸"],
    "ìš©ë„": [
        "ì•¡ì²´ë¥¼ ë‹´ê±°ë‚˜ ê°€ì—´, í˜¼í•©í•  ë•Œ ì‚¬ìš© (ì •ë°€ ì¸¡ì • X)", 
        "ì•¡ì²´ ë°˜ì‘, ë³´ê´€, í”ë“¤ê¸° (ì…êµ¬ê°€ ì¢ìŒ)", 
        "ì†ŒëŸ‰ì˜ ì‹œë£Œ ê°€ì—´ ë° ë°˜ì‘ ì‹¤í—˜", 
        "ì•¡ì²´ì˜ ë¶€í”¼ë¥¼ ì •í™•í•˜ê²Œ ì¸¡ì •", 
        "ì†ŒëŸ‰ì˜ ì•¡ì²´ë¥¼ ì •í™•í•˜ê²Œ ëœì–´ë‚¼ ë•Œ ì‚¬ìš©",
        "ì‘ì€ ë¬¼ì²´ë¥¼ í™•ëŒ€í•˜ì—¬ ê´€ì°°",
        "ì†ŒëŸ‰ì˜ ì•¡ì²´ë¥¼ ì˜®ê¸¸ ë•Œ ì‚¬ìš© (ì •ë°€ ì¸¡ì • X)",
        "ëœ¨ê±°ìš´ ë¬¼ì²´ë‚˜ ë„êµ¬ë¥¼ ì¡ì„ ë•Œ ì‚¬ìš©",
        "ì˜¨ë„ë¥¼ ì¸¡ì •",
        "ë¬¼ì²´ì˜ ì§ˆëŸ‰ì„ ì¸¡ì •"
    ],
    "ê´€ë ¨_í‚¤ì›Œë“œ": [
        "ìœ ë¦¬,ì•¡ì²´,í˜¼í•©,ê°€ì—´,í™”í•™,ì¸¡ì •",
        "ìœ ë¦¬,ì•¡ì²´,ë°˜ì‘,ë³´ê´€,í™”í•™",
        "ìœ ë¦¬,ê°€ì—´,ë°˜ì‘,í™”í•™,ì‹œë£Œ",
        "ìœ ë¦¬,ë¶€í”¼,ì¸¡ì •,ìš©ëŸ‰",
        "ìœ ë¦¬,ë¶€í”¼,ì •í™•,ì•¡ì²´,ëœì–´ë‚´ê¸°",
        "ê´‘í•™,ê´€ì°°,ì„¸í¬,ë¯¸ìƒë¬¼,í™•ëŒ€",
        "ê³ ë¬´,í”Œë¼ìŠ¤í‹±,ì•¡ì²´,ì˜®ê¸°ê¸°",
        "ê¸ˆì†,ê°€ì—´,ì•ˆì „,ì§‘ê¸°",
        "ìœ ë¦¬,ì¸¡ì •,ì—´",
        "ë¬´ê²Œ,ì¸¡ì •,ì „ì"
    ]
}

df_equipment = pd.DataFrame(LAB_EQUIPMENT_DATA)

# --- 2. Streamlit ì•± ì„¤ì • ë° UI êµ¬ì„± ---
st.set_page_config(
    page_title="ê³¼í•™ ì‹¤í—˜ ë„êµ¬ ê²€ìƒ‰ ğŸ”",
    layout="wide",
    initial_sidebar_state="expanded"
)

st.title("ğŸ”¬ ê³¼í•™ ì‹¤í—˜ ë„êµ¬ ê²€ìƒ‰ê¸°")
st.markdown("---")

# ê²€ìƒ‰ ì…ë ¥ í•„ë“œ
search_query = st.text_input(
    "**ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì¸¡ì •, í˜„ë¯¸ê²½, ê°€ì—´)**",
    placeholder="ë„êµ¬ëª…, ìš©ë„, í‚¤ì›Œë“œë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”...",
    key="search_input"
)

# --- 3. ê²€ìƒ‰ ë¡œì§ í•¨ìˆ˜ ---
def search_equipment(df: pd.DataFrame, query: str) -> pd.DataFrame:
    """
    ë„êµ¬ëª…, ìš©ë„, ê´€ë ¨_í‚¤ì›Œë“œ ì—´ì—ì„œ ê²€ìƒ‰ì–´ì™€ ì¼ì¹˜í•˜ëŠ” ë°ì´í„°ë¥¼ í•„í„°ë§í•©ë‹ˆë‹¤.
    (ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ì´, ë¶€ë¶„ ì¼ì¹˜ ê²€ìƒ‰)
    """
    if not query:
        return df # ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì „ì²´ ë°ì´í„° ë°˜í™˜

    # ì •ê·œ í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ì´ ê²€ìƒ‰
    # .str.contains()ëŠ” íŒë‹¤ìŠ¤ ë¬¸ìì—´ ë©”ì„œë“œë¡œ, Seriesì˜ ê° ìš”ì†Œê°€ ì •ê·œ í‘œí˜„ì‹ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
    regex = re.escape(query) # íŠ¹ìˆ˜ë¬¸ìë¥¼ ì¼ë°˜ ë¬¸ìë¡œ ì·¨ê¸‰í•˜ë„ë¡ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬
    
    mask = (
        df["ë„êµ¬ëª…"].str.contains(regex, case=False) |
        df["ìš©ë„"].str.contains(regex, case=False) |
        df["ê´€ë ¨_í‚¤ì›Œë“œ"].str.contains(regex, case=False)
    )
    
    return df[mask]

# --- 4. ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ ---
if search_query:
    # ê²€ìƒ‰ í•¨ìˆ˜ ì‹¤í–‰
    filtered_df = search_equipment(df_equipment, search_query)
    
    st.header(f"'{search_query}' ê²€ìƒ‰ ê²°ê³¼")
    
    if not filtered_df.empty:
        st.success(f"ì´ **{len(filtered_df)}ê°œ**ì˜ ë„êµ¬ê°€ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤.")
        
        # ê²€ìƒ‰ ê²°ê³¼ë¥¼ Streamlit ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ í‘œì‹œ
        # ì¸ë±ìŠ¤(ìˆœë²ˆ)ë¥¼ ìˆ¨ê¸°ê³ , ì»¬ëŸ¼ ë„ˆë¹„ë¥¼ ì¡°ì •í•©ë‹ˆë‹¤.
        st.dataframe(
            filtered_df,
            hide_index=True,
            column_config={
                "ë„êµ¬ëª…": st.column_config.TextColumn("ë„êµ¬ëª…", width="small"),
                "ìš©ë„": st.column_config.TextColumn("ì£¼ìš” ìš©ë„", width="medium"),
                "ê´€ë ¨_í‚¤ì›Œë“œ": st.column_config.TextColumn("ê´€ë ¨ í‚¤ì›Œë“œ", width="large"),
            }
        )
        
    else:
        st.warning("ì¼ì¹˜í•˜ëŠ” ì‹¤í—˜ ë„êµ¬ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì‹œë„í•´ ë³´ì„¸ìš”.")

else:
    # ê²€ìƒ‰ì–´ê°€ ì—†ì„ ë•Œ ì „ì²´ ëª©ë¡ ë³´ì—¬ì£¼ê¸°
    st.header("ì „ì²´ ì‹¤í—˜ ë„êµ¬ ëª©ë¡")
    st.info("ê²€ìƒ‰ì°½ì— í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì—¬ í•„ìš”í•œ ë„êµ¬ë¥¼ ì°¾ì•„ë³´ì„¸ìš”.")
    
    st.dataframe(
        df_equipment,
        hide_index=True,
        column_config={
            "ë„êµ¬ëª…": st.column_config.TextColumn("ë„êµ¬ëª…", width="small"),
            "ìš©ë„": st.column_config.TextColumn("ì£¼ìš” ìš©ë„", width="medium"),
            "ê´€ë ¨_í‚¤ì›Œë“œ": st.column_config.TextColumn("ê´€ë ¨ í‚¤ì›Œë“œ", width="large"),
        }
    )

# --- 5. GitHub ì •ë³´ (ì„ íƒ ì‚¬í•­) ---
st.sidebar.header("ğŸ“ ì•± ì •ë³´")
st.sidebar.markdown(
    """
    ì´ ì•±ì€ Streamlitìœ¼ë¡œ ê°œë°œëœ
    **ê³¼í•™ ì‹¤í—˜ ë„êµ¬ ê²€ìƒ‰ ì•±**ì…ë‹ˆë‹¤.
    """
)
st.sidebar.markdown("---")
st.sidebar.markdown("**ì½”ë“œ ê³µê°œ (GitHub)**")
st.sidebar.markdown("[GitHub ë¦¬í¬ì§€í† ë¦¬ ë§í¬ ì‚½ì… ì˜ˆì •]")
